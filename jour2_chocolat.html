<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Le Go√ªt Sucr√© de l‚Äô√âternel ‚Äî Jour 2</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;0,700;1,600&family=Montserrat:wght@400;600;700&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
:root{
  --choco-900:#2a1812;
  --choco-850:#332018;
  --choco-800:#3d271e;

  --gold-1:#f3e5c7;
  --gold-2:#e4c58c;
  --gold-3:#c9a67a;
  --gold-4:#b48a64;

  --ink:#efe7dc;
  --ink-soft:rgba(239,231,220,.88);

  --error:#ffb4b4;
  --success:#9fe0b8;

  --panel: rgba(61,39,30, 0.54);
  --panel2: rgba(61,39,30, 0.40);

  --shadow: 0 16px 44px rgba(0,0,0,.34);
}

body{
  margin:0;
  font-family:'Montserrat',sans-serif;
  color:var(--ink);
  line-height:1.7;
  overflow-x:hidden;
  scroll-behavior:smooth;

  background:
    radial-gradient(900px 560px at 12% 10%, rgba(243,229,199,.12) 0%, rgba(42,24,18,0) 62%),
    radial-gradient(840px 560px at 86% 12%, rgba(201,166,122,.10) 0%, rgba(42,24,18,0) 66%),
    radial-gradient(900px 760px at 50% 92%, rgba(180,138,100,.12) 0%, rgba(42,24,18,0) 66%),
    linear-gradient(180deg, var(--choco-900) 0%, var(--choco-850) 48%, var(--choco-800) 100%);
  position:relative;
}

body:before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:.10;
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

.hero-banner{
  height:310px;
  background:url("images/photo_musee_choco.jpg") center/cover no-repeat;
  position:relative;
  border-bottom:1px solid rgba(201,166,122,.28);
  box-shadow:0 18px 50px rgba(0,0,0,.45);
}
.hero-banner::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    linear-gradient(to bottom, rgba(0,0,0,.10) 0%, rgba(42,24,18,.35) 55%, var(--choco-900) 100%);
}

main{
  max-width:920px;
  margin:-86px auto 70px;
  padding:25px;
}

.bloc-contenu{
  background: var(--panel);
  backdrop-filter: blur(7px);
  padding: 42px 30px;
  border-radius: 22px;
  border: 1px solid rgba(201,166,122,.22);
  box-shadow: var(--shadow);
  max-width:860px;
  margin:0 auto;
}

.kicker{
  text-align:center;
  letter-spacing:.16em;
  text-transform:uppercase;
  font-size:12px;
  color: rgba(243,229,199,.74);
  margin-bottom: 10px;
}
h1{
  font-family:'Cormorant Garamond',serif;
  font-size:44px;
  font-weight:700;
  text-align:center;
  margin: 0 0 10px;
  color: transparent;
  background: linear-gradient(135deg, var(--gold-1) 0%, var(--gold-2) 55%, var(--gold-4) 100%);
  -webkit-background-clip: text;
  background-clip:text;
  text-shadow: 0 10px 28px rgba(243,229,199,.06);
}
p{
  margin: 0.70rem 0;
  color: var(--ink-soft);
  font-family:'Cormorant Garamond',serif;
  font-size:1.18rem;
  text-align:center;
}

.panel{
  background: var(--panel2);
  border:1px solid rgba(201,166,122,.18);
  border-radius:16px;
  box-shadow: 0 12px 30px rgba(0,0,0,.22);
  padding: 18px 16px;
  margin: 18px 0;
}

#counterHint{
  text-align:center;
  font-weight:700;
  margin-top: 10px;
  color: rgba(243,229,199,.80);
  letter-spacing:.02em;
}

.sensations-wrap{
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 14px;
  margin-top: 18px;
}
@media (max-width: 740px){
  .sensations-wrap{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

.sensation{
  user-select:none;
  cursor:pointer;
  border-radius: 999px;
  border: 1px solid rgba(201,166,122,.32);
  padding: 12px 14px;
  background:
    radial-gradient(120px 80px at 30% 30%, rgba(243,229,199,.10) 0%, rgba(61,39,30,0) 62%),
    linear-gradient(180deg, rgba(88,58,44,.42), rgba(61,39,30,.52));
  box-shadow: 0 10px 22px rgba(0,0,0,.20);
  transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  min-height: 56px;
  text-align:center;
}

.sensation:hover{ transform: translateY(-2px); box-shadow: 0 16px 28px rgba(0,0,0,.26); }

.emoji{
  font-size: 1.05rem;
  opacity:.95;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.28));
}
.lab{
  font-weight:700;
  font-size:1.02rem;
  letter-spacing:.02em;
  color: rgba(243,229,199,.92);
  font-family:'Montserrat',sans-serif;
}

.sensation.selected{
  border-color: rgba(243,229,199,.58);
  box-shadow:
    0 18px 32px rgba(0,0,0,.28),
    0 0 0 2px rgba(243,229,199,.12),
    0 0 24px rgba(243,229,199,.12);
  background: linear-gradient(135deg, rgba(201,166,122,.28), rgba(180,138,100,.18));
}
.sensation.selected .lab{ color: rgba(42,24,18,.92); }
.sensation.selected .emoji{ filter:none; }

.sensation:focus-visible, .bouton-action:focus-visible, .reset-link:focus-visible{
  outline: 2px solid var(--gold-2);
  outline-offset: 4px;
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}
.shake-element{
  animation: shake 0.4s ease-in-out;
  border-color: var(--error) !important;
}

.boutons{ text-align:center; margin-top: 18px; }
.bouton-action{
  display:inline-block;
  padding: 12px 22px;
  margin: 10px 8px;
  border-radius: 999px;
  text-decoration:none;
  font-weight:700;
  text-transform: uppercase;
  letter-spacing:.06em;
  transition: all .25s ease;
  box-shadow: 0 12px 26px rgba(0,0,0,.20);
  text-align:center;
  border: 1px solid rgba(201,166,122,.30);
  background: rgba(243,229,199,.06);
  color: rgba(243,229,199,.92);
  cursor:pointer;
  font-family:'Montserrat',sans-serif;
  font-size:.92rem;
}

.bouton-action:hover{
  transform: translateY(-2px);
  background: linear-gradient(135deg, rgba(243,229,199,.14), rgba(201,166,122,.10));
  border-color: rgba(243,229,199,.42);
}

.bouton-principal{
  background: linear-gradient(135deg, rgba(243,229,199,.16), rgba(201,166,122,.12));
  border: 1px solid rgba(243,229,199,.42);
}
.bouton-action.locked{ opacity:.45; cursor:not-allowed; }

.message-feedback{
  text-align:center;
  margin-top: 12px;
  font-size: 1.05rem;
  font-weight:700;
  color: var(--error);
  min-height: 1.5em;
  font-family:'Cormorant Garamond',serif;
}

.step{ display:none; margin-top: 22px; }
.step.active{ display:block; }

.envelope-card{
  margin: 10px auto 0;
  max-width: 720px;
  border-radius: 18px;
  border: 1px solid rgba(243,229,199,.20);
  background: rgba(42,24,18,.35);
  padding: 18px 16px;
  box-shadow: 0 16px 34px rgba(0,0,0,.26);
  text-align:center;
}
.envelope-kicker{
  text-transform: uppercase;
  font-size: 0.78rem;
  letter-spacing: 0.16em;
  color: rgba(243,229,199,.68);
  margin: 0 0 10px;
  font-family:'Montserrat',sans-serif;
  font-weight:700;
}
.envelope-title{
  font-family:'Great Vibes',cursive;
  font-size: clamp(2.0rem, 5vw, 2.6rem);
  margin: 0 0 10px;
  color: transparent;
  background: linear-gradient(to bottom, var(--gold-1), var(--gold-3));
  -webkit-background-clip:text;
  background-clip:text;
  text-shadow: 0 10px 26px rgba(243,229,199,.08);
}
.envelope-text{
  font-family:'Cormorant Garamond',serif;
  font-style: italic;
  color: rgba(239,231,220,.90);
  font-size: 1.18rem;
  line-height:1.55;
  margin: 0;
}

/* Ticket / mus√©e / adresse / horaires centr√©s */
.place-card{
  margin: 16px auto 0;
  max-width: 680px;
  border-radius: 18px;
  border: 1px solid rgba(243,229,199,.22);
  background: rgba(42,24,18,.42);
  padding: 16px;
  display:flex;
  flex-direction:column;
  gap: 10px;
  align-items:center;
  text-align:center;
  box-shadow: 0 16px 34px rgba(0,0,0,.26);
}
.place-ico{
  width:62px; height:62px;
  border-radius: 16px;
  background: rgba(243,229,199,.06);
  border: 1px solid rgba(243,229,199,.16);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 1.8rem;
}
.place-title{
  margin:0;
  font-weight:800;
  color: rgba(243,229,199,.95);
  letter-spacing:.06em;
  text-transform:uppercase;
  font-family:'Montserrat',sans-serif;
  font-size: .95rem;
}
.place-addr{
  margin:4px 0 0;
  white-space: pre-line;
  color: rgba(239,231,220,.88);
  font-family:'Cormorant Garamond',serif;
  font-size:1.12rem;
  line-height:1.35;
}
.place-hours{
  margin:6px 0 0;
  color: rgba(239,231,220,.86);
  font-family:'Cormorant Garamond',serif;
  font-size:1.10rem;
}

/* Apr√®s visite : cach√© */
#afterVisit{ display:none; }

/* Carte finale */
.fin-card{
  margin: 22px auto 0;
  max-width: 760px;
  border-radius: 6px;
  padding: 40px 30px;
  text-align: center;
  background-color: #20120d;
  background-image:
    radial-gradient(circle at 50% 0%, rgba(243,229,199, 0.16), transparent 60%),
    url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23c9a67a' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
  box-shadow:
    0 20px 50px rgba(0,0,0,0.48),
    0 0 0 1px rgba(201, 166, 122, 0.28),
    0 0 0 6px rgba(42, 24, 18, 0.70),
    0 0 0 7px rgba(201, 166, 122, 0.44);
}

.fin-script-title{
  font-family:'Great Vibes',cursive;
  font-size: clamp(2.5rem, 5vw, 3.4rem);
  margin: 0 0 18px;
  line-height: 1.1;
  background: linear-gradient(to bottom, var(--gold-1), var(--gold-3));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.55));
}

.fin-divider{
  font-size: 22px;
  color: var(--gold-3);
  margin: 6px 0 20px;
  opacity: 0.85;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
}
.fin-divider::before, .fin-divider::after{
  content:"";
  display:block;
  width:60px;
  height:1px;
  background: linear-gradient(90deg, transparent, var(--gold-3), transparent);
}

.fin-body{
  font-family:'Cormorant Garamond',serif;
  font-size: 1.30rem;
  line-height: 1.6;
  color: var(--ink);
  font-weight: 600;
  font-style: italic;
  max-width: 620px;
  margin: 0 auto;
  text-shadow: 0 1px 2px rgba(0,0,0,0.75);
}

.fin-body::first-letter{
  font-family:'Great Vibes',cursive;
  font-size: 3.1em;
  float: left;
  line-height: 0.7;
  margin-right: 8px;
  margin-top: 5px;
  color: var(--gold-2);
  text-shadow: 0 2px 10px rgba(201,166,122, 0.24);
}

.fin-signature{
  font-family:'Great Vibes',cursive;
  font-size: 2rem;
  margin-top: 26px;
  color: var(--gold-2);
  transform: rotate(-3deg);
  display: inline-block;
  text-shadow: 0 2px 4px rgba(0,0,0,0.55);
}

/* Footer boutons */
footer{
  text-align:center;
  margin: 24px 0 6px;
}
.btn-footer{
  display:inline-block;
  text-decoration:none;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight:700;
  letter-spacing:.06em;
  text-transform: uppercase;
  font-size: .88rem;
  border: 1px solid rgba(243,229,199,.22);
  background: rgba(243,229,199,.06);
  color: rgba(243,229,199,.90);
  box-shadow: 0 12px 26px rgba(0,0,0,.18);
  transition: transform .2s ease, background .2s ease, border-color .2s ease;
  margin: 6px 6px;
  font-family:'Montserrat',sans-serif;
}
.btn-footer:hover{
  transform: translateY(-2px);
  background: rgba(243,229,199,.10);
  border-color: rgba(243,229,199,.34);
}

/* Reset discret bas de page */
.reset-footer{
  margin-top: 18px;
  text-align:center;
  opacity: .35;
}
.reset-link{
  font-family:'Montserrat',sans-serif;
  font-size: 0.72rem;
  letter-spacing: .14em;
  text-transform: uppercase;
  color: rgba(243,229,199,.70);
  text-decoration:none;
  border-bottom: 1px dotted rgba(243,229,199,.35);
  padding-bottom: 2px;
}
.reset-link:hover{
  opacity: 1;
  border-bottom-color: rgba(243,229,199,.70);
}

/* MOBILE */
@media (max-width:600px){
  main{padding:0;}
  .bloc-contenu{margin:5vw; padding:22px;}
  h1{font-size:2.2rem;}
  .hero-banner{height:240px;}
  .fin-body{ font-size: 1.18rem; text-align: left; }
}
</style>
</head>

<body>

<div class="hero-banner" aria-hidden="true"></div>

<main>
  <div class="bloc-contenu">

    <div class="kicker">Jour 2 ‚Ä¢ Mill√©sime</div>
    <h1>Le Go√ªt Sucr√© de l‚Äô√âternel</h1>

    <p>
      Apr√®s le vin de la maturit√© vient le temps de la douceur‚Ä¶<br>
      Choisissez <strong>trois</strong> notes √† emporter avec vous ‚Äî comme on choisit trois souvenirs.
    </p>

    <div id="counterHint">0 / 3 s√©lectionn√©es</div>

    <div class="sensations-wrap" id="sensations" aria-label="Choix des go√ªts">
      <div class="sensation" data-key="cacao"><span class="emoji" aria-hidden="true">üç´</span><span class="lab">Cacao</span></div>
      <div class="sensation" data-key="vanille"><span class="emoji" aria-hidden="true">üåº</span><span class="lab">Vanille</span></div>
      <div class="sensation" data-key="cafe"><span class="emoji" aria-hidden="true">‚òï</span><span class="lab">Caf√©</span></div>
      <div class="sensation" data-key="noisette"><span class="emoji" aria-hidden="true">üå∞</span><span class="lab">Noisette</span></div>
      <div class="sensation" data-key="orange"><span class="emoji" aria-hidden="true">üçä</span><span class="lab">Orange</span></div>
      <div class="sensation" data-key="fleurdesel"><span class="emoji" aria-hidden="true">üßÇ</span><span class="lab">Fleur de sel</span></div>
    </div>

    <div class="boutons">
      <button class="bouton-action" id="resetBtn" type="button" style="opacity:.35">R√©initialiser</button>
      <button class="bouton-action bouton-principal locked" id="carryBtn" type="button" disabled>
        Emporter ces sensations
      </button>
    </div>

    <p class="message-feedback" id="msg"></p>

    <section class="step" id="stepEnvelope" aria-live="polite">
      <div class="envelope-card">
        <div class="envelope-kicker">Jour 2 ‚Ä¢ Activit√© 2</div>
        <div class="envelope-title">L‚Äôenveloppe du cacao</div>
        <p class="envelope-text">
          Le secret ne se trouve pas seulement ici‚Ä¶<br>
          Prenez l‚Äôenveloppe <strong>Jour 2 ‚Äî Activit√© 2</strong>.<br>
          √Ä l‚Äôint√©rieur, vous trouverez votre <strong>ticket d‚Äôentr√©e</strong>.
        </p>
        <div class="boutons" style="margin-top:12px;">
          <button class="bouton-action bouton-principal" id="haveItBtn" type="button">Nous l‚Äôavons</button>
        </div>
      </div>
    </section>

    <section class="step" id="stepReveal" aria-live="polite">

      <div class="panel">
        <p style="margin:0;">
          Parfait. Gardez ce ticket pr√©cieusement‚Ä¶<br>
          Il ouvre la porte d‚Äôun lieu o√π la gourmandise devient un art.
        </p>

        <div class="place-card" role="group" aria-label="Informations du mus√©e">
          <div class="place-ico" aria-hidden="true">üéüÔ∏è</div>
          <div>
            <p class="place-title">MUS√âE ART DU CHOCOLAT</p>
            <p class="place-addr">13 Place Paul Saissac
Lisle-sur-Tarn</p>
            <p class="place-hours">Ouvert de <strong>10h √† 12h30</strong> et de <strong>14h √† 18h</strong></p>
          </div>
        </div>

        <p style="margin-top:14px; font-style:italic; opacity:.92;">
          Prenez votre temps. Ici, on go√ªte autant qu‚Äôon se souvient.
        </p>
      </div>

      <div id="afterVisit">
        <div class="fin-card">
          <div class="fin-script-title">Des souvenirs plein la t√™te</div>
          <div class="fin-divider">‚ú¶</div>
          <div class="fin-body">
            Nous esp√©rons sinc√®rement que cette escapade a √©t√© √† la hauteur de vos r√™ves.
            Ce cadeau, n√© de tout notre amour et fa√ßonn√© par nos pens√©es r√©unies, n'avait qu'un seul but : votre bonheur.<br><br>

            Si vous avez pu savourer chaque instant et faire le plein de beaux moments, notre mission est accomplie.
            Pour prolonger un peu la magie, n'h√©sitez pas √† nous confier vos impressions et vos clich√©s pr√©f√©r√©s dans le Livre d‚ÄôOr.
          </div>
          <div class="fin-signature">Avec toute notre affection ‚ú®</div>
        </div>

        <div class="boutons" style="margin-top:16px;">
          <a class="bouton-action bouton-principal" href="livre_or.html">Ouvrir le Livre d‚ÄôOr</a>
        </div>
      </div>

      <footer>
        <a class="btn-footer" href="jour2_accueil.html">Retrouver le fil du voyage</a>
        <a class="btn-footer" href="index.html">Retour au carnet de voyage</a>

        <!-- ‚úÖ Reset ultra discret -->
        <div class="reset-footer">
          <a href="#" class="reset-link" id="resetProgressLink">Reset progression</a>
        </div>
      </footer>

    </section>

  </div>
</main>

<script>
(() => {
  // ===== CONFIG =====
  const MODE_TEST = true; // 10s (test). Passer √† false pour 1h.

  const CONFIG = {
    keyDone: "millesime_j2_step2_done",
    keySensations: "millesime_j2_sensations",
    keyStartTime: "j2_choco_start_time",
    maxSelection: 3,
    delayShowAfterVisit: MODE_TEST ? 10000 : 60 * 60 * 1000
  };

  const els = {
    wrap: document.getElementById("sensations"),
    pills: Array.from(document.querySelectorAll(".sensation")),
    counter: document.getElementById("counterHint"),
    msg: document.getElementById("msg"),
    resetBtn: document.getElementById("resetBtn"),
    carryBtn: document.getElementById("carryBtn"),
    stepEnvelope: document.getElementById("stepEnvelope"),
    stepReveal: document.getElementById("stepReveal"),
    haveItBtn: document.getElementById("haveItBtn"),
    afterVisit: document.getElementById("afterVisit"),
    resetProgressLink: document.getElementById("resetProgressLink")
  };

  let selected = new Set();

  const storage = {
    set: (k,v) => { try { localStorage.setItem(k,v); } catch(e){} },
    get: (k) => { try { return localStorage.getItem(k); } catch(e){ return null; } },
    del: (k) => { try { localStorage.removeItem(k); } catch(e){} }
  };

  function setMsg(text, type="neutral"){
    els.msg.textContent = text || "";
    if (type === "error") els.msg.style.color = "var(--error)";
    else if (type === "success") els.msg.style.color = "var(--success)";
    else els.msg.style.color = "inherit";
  }

  function updateUI(){
    const count = selected.size;
    els.counter.textContent = `${count} / ${CONFIG.maxSelection} s√©lectionn√©es`;
    const canCarry = (count === CONFIG.maxSelection);
    els.carryBtn.disabled = !canCarry;
    els.carryBtn.classList.toggle("locked", !canCarry);
  }

  function lockSelection(){
    els.pills.forEach(p => {
      p.style.pointerEvents = "none";
      p.tabIndex = -1;
    });
    els.resetBtn.style.display = "none";
    els.carryBtn.style.display = "none";
  }

  function showStep(el){
    el.classList.add("active");
    setTimeout(() => el.scrollIntoView({behavior:"smooth", block:"start"}), 100);
  }

  function handleSelection(pill){
    if (!pill) return;

    const key = pill.dataset.key;
    const isSelected = selected.has(key);

    if (isSelected){
      pill.classList.remove("selected");
      selected.delete(key);
      setMsg("");
      updateUI();
      return;
    }

    if (selected.size >= CONFIG.maxSelection){
      setMsg("Trois suffisent pour emporter l‚Äôessentiel‚Ä¶", "error");
      pill.classList.add("shake-element");
      setTimeout(() => pill.classList.remove("shake-element"), 420);
      return;
    }

    pill.classList.add("selected");
    selected.add(key);
    setMsg("");
    updateUI();
  }

  // Accessibilit√© clavier
  els.pills.forEach(el => {
    el.setAttribute("role", "button");
    el.setAttribute("tabindex", "0");
    el.setAttribute("aria-pressed", "false");
    el.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        handleSelection(el);
      }
    });
  });

  els.wrap.addEventListener("click", (e) => {
    handleSelection(e.target.closest(".sensation"));
    els.pills.forEach(p => p.setAttribute("aria-pressed", p.classList.contains("selected")));
  });

  els.resetBtn.addEventListener("click", () => {
    selected.clear();
    els.pills.forEach(p => p.classList.remove("selected"));
    setMsg("R√©initialis√© ‚úÖ", "success");
    updateUI();
  });

  function maybeShowAfterVisit(){
    const start = storage.get(CONFIG.keyStartTime);
    if (!start) return;

    const now = Date.now();
    const elapsed = now - parseInt(start, 10);

    if (elapsed >= CONFIG.delayShowAfterVisit){
      els.afterVisit.style.display = "block";
      // Option bonus : scroll doux √† l'apparition
      setTimeout(() => els.afterVisit.scrollIntoView({behavior:"smooth", block:"start"}), 200);
    } else {
      const retryDelay = MODE_TEST ? 1000 : 60000;
      setTimeout(maybeShowAfterVisit, retryDelay);
    }
  }

  // √âtape 1 -> √âtape 2
  els.carryBtn.addEventListener("click", () => {
    if (selected.size !== CONFIG.maxSelection) return;
    lockSelection();
    showStep(els.stepEnvelope);
  });

  // √âtape 2 -> √âtape 3
  els.haveItBtn.addEventListener("click", () => {
    storage.set(CONFIG.keySensations, JSON.stringify([...selected]));
    storage.set(CONFIG.keyDone, "1");
    storage.set("j2_choco_ok", "true");

    if (!storage.get(CONFIG.keyStartTime)) {
      storage.set(CONFIG.keyStartTime, String(Date.now()));
    }

    els.stepEnvelope.style.display = "none";
    showStep(els.stepReveal);
    maybeShowAfterVisit();
  });

  // Reset progression discret (pour tests)
  els.resetProgressLink.addEventListener("click", (e) => {
    e.preventDefault();
    storage.del(CONFIG.keySensations);
    storage.del(CONFIG.keyDone);
    storage.del(CONFIG.keyStartTime);
    storage.del("j2_choco_ok");
    // Recharge pour repartir de z√©ro
    location.reload();
  });

  // Init si d√©j√† valid√©
  const alreadyDone = storage.get(CONFIG.keyDone) === "1";
  if (alreadyDone){
    els.counter.textContent = "√âtape d√©j√† accomplie ‚úÖ";
    lockSelection();
    els.stepEnvelope.style.display = "none";
    els.stepReveal.classList.add("active");
    maybeShowAfterVisit();
  } else {
    updateUI();
  }
})();
</script>

</body>
</html>
