<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Test Visuel - Le Premier Secret</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">

<style>
    /* --- COULEURS --- */
    :root {
        --color-cacao-dark: #4F352C;
        --color-mill√©sime-gold: #B48A64;
        --color-beige-textile: #F7F4F0;
        --color-text-dark: #3E332C;
        --color-lock-red: #924B4B;
        --color-accent-gold: #d89617;
    }

    body {
        margin: 0;
        font-family: 'Lato', sans-serif;
        background: url('images/fond-noel.jpg') center/cover no-repeat fixed; 
        color: var(--color-text-dark);
        text-align: center;
        overflow-x: hidden;
        transition: background 0.5s ease; 
    }
    
    body.final-background {
        background: url('images/cadeau-ouvert-millesime.png') center bottom no-repeat fixed;
        background-size: auto; 
    }

    /* --- CONTENEUR --- */
    .contenu {
        background: rgba(255,250,240,0.92);
        max-width: 900px;
        margin: 4vw auto;
        padding: 4vw;
        border-radius: 20px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        transition: opacity 3s ease;
    }

    h1 {
        font-family: 'Cormorant Garamond', serif;
        color: var(--color-cacao-dark);
        font-size: 2rem;
        margin-bottom: 1rem;
        font-weight: 700;
    }

    p { line-height: 1.8; margin: 1rem 0; }
    .intro-text strong { color: var(--color-accent-gold); }

    #demarrer {
        display: inline-block;
        margin-top: 1.5rem;
        color: var(--color-mill√©sime-gold);
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }
    #demarrer:hover { text-decoration: underline; color: var(--color-accent-gold); }

    /* --- CADEAU --- */
    .cadeau {
        position: relative;
        margin: 4vw auto;
        width: 280px;
        height: 280px;
        background: url('images/cadeau.jpg') center/cover no-repeat;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        display: none; 
        cursor: pointer;
        transition: transform 1.5s ease;
        z-index: 10;
        filter: none;
    }

    .etincelles {
        position: absolute;
        top: 50%; left: 50%;
        width: 180px; height: 180px;
        transform: translate(-50%, -50%);
        display: none; pointer-events: none;
    }

    /* MODIFICATION : Animation plus vivante une fois ouvert */
    .cadeau.ouvert {
        transform: scale(1.1) rotateX(10deg);
        filter: brightness(1.2);
        animation: heartbeat 3s infinite ease-in-out; /* Battement de coeur */
    }

    @keyframes heartbeat {
        0% { transform: scale(1.1) rotateX(10deg); }
        50% { transform: scale(1.15) rotateX(10deg); }
        100% { transform: scale(1.1) rotateX(10deg); }
    }

    /* --- √âNIGME (AM√âLIORATION VISUELLE) --- */
    .enigme {
        display: none;
        margin: 15vh auto 2rem;
        background: rgba(255,255,255,0.9); /* Un peu plus opaque */
        padding: 2rem 3rem;
        border-radius: 4px; /* Plus carr√© pour faire "papier" */
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        max-width: 450px;
        font-family: 'Cormorant Garamond', serif;
        border: 1px solid rgba(180, 138, 100, 0.3); /* Bordure fine dor√©e */
    }

    .enigme-container {
        display: flex;
        flex-direction: column; /* Stack vertical pour le style manuscrit */
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    /* MODIFICATION : Input style "Ligne manuscrite" */
    .enigme input {
        padding: 10px 5px;
        border: none;
        border-bottom: 2px solid var(--color-mill√©sime-gold); /* Juste la ligne du bas */
        background: transparent;
        border-radius: 0;
        margin-top: 1rem;
        width: 100%;
        text-align: center;
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.5rem; /* Plus grand */
        font-weight: 700;
        color: var(--color-cacao-dark);
        outline: none;
        transition: border-color 0.3s;
    }

    .enigme input::placeholder {
        color: rgba(79, 53, 44, 0.4);
        font-style: italic;
        font-weight: 400;
        font-size: 1.2rem;
    }

    .enigme input:focus {
        border-bottom-color: var(--color-cacao-dark); /* Fonce au focus */
    }

    .enigme button {
        background: var(--color-mill√©sime-gold);
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 50px; /* Plus rond */
        margin-top: 1rem;
        cursor: pointer;
        font-weight: bold;
        font-family: 'Lato', sans-serif;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: transform 0.2s, background 0.3s;
    }
    .enigme button:hover { 
        background: #9d7553; 
        transform: translateY(-2px);
    }

    /* --- AUTRES √âL√âMENTS --- */
    #btnAide, #indice {
        font-size: 0.9rem;
        color: var(--color-cacao-dark);
        cursor: pointer;
        margin-top: 15px;
        font-family: 'Lato', sans-serif;
    }
    #btnAide:hover { text-decoration: underline; }

    #clip-container {
        display: none;
        width: 90%; max-width: 700px;
        margin: 3vw auto;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    #clip { width: 100%; height: auto; border-radius: 16px; }

    .message {
        display: none;
        font-style: italic;
        margin-top: 1.5rem;
        color: var(--color-accent-gold);
        font-weight: 600;
        font-family: 'Cormorant Garamond', serif;
    }

    /* --- BLOC CHANSON --- */
    #chanson-teaser {
        display: none;
        max-width: 500px;
        margin: 10vh auto;
        border-radius: 15px;
        font-family: 'Cormorant Garamond', serif;
    }

    #chanson-teaser.final-teaser {
        background: rgba(247, 228, 217, 0.90); 
        max-width: 600px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        padding-top: 40px; padding-bottom: 40px;
        transition: height 0.5s ease;
    }

    #chanson-teaser p {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.2rem; margin: 5px 0;
        line-height: 1.3; color: var(--color-text-dark);
    }

    .final-text-line { font-size: 1.5rem; font-weight: 700; }

    .final-click-prompt {
        font-size: 1.1rem; font-weight: 600;
        margin-top: 30px; color: var(--color-text-dark);
    }
    
    .envelope-trigger {
        cursor: pointer;
        display: inline-block;
        margin-top: 15px;
        transition: transform 0.3s ease;
    }
    .envelope-trigger:hover { transform: scale(1.05); }

    .envelope-image {
        width: 100%; max-width: 280px; height: auto;
        border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        background: none; border: none; 
    }

    /* MODIFICATION : Animation "En cours d'√©coute" */
    .music-listening-state {
        display: none; /* Cach√© par d√©faut */
        margin-top: 20px;
        animation: pulseText 2.5s infinite ease-in-out;
    }
    .music-note {
        font-size: 3rem;
        color: var(--color-mill√©sime-gold);
        display: block;
        margin-bottom: 10px;
    }
    @keyframes pulseText {
        0% { opacity: 0.6; transform: scale(0.98); }
        50% { opacity: 1; transform: scale(1.02); }
        100% { opacity: 0.6; transform: scale(0.98); }
    }

    /* --- MESSAGE DE FIN --- */
    .locked-message {
        display: none;
        text-align: center;
        color: var(--color-text-dark);
        font-weight: 500;
        background: rgba(255,248,240,0.9);
        padding: 25px 35px;
        border-radius: 10px;
        margin: 30px auto;
        max-width: 600px;
        box-shadow: 0 0 15px rgba(255,255,255,0.5);
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.2rem;
        border: 1px solid var(--color-mill√©sime-gold);
    }

    .retour {
        display: none;
        background: var(--color-mill√©sime-gold);
        color: white;
        padding: 12px 30px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 30px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        transition: 0.3s;
        margin-left: auto; margin-right: auto;
        width: fit-content;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .retour:hover { background: #9d7553; transform: translateY(-3px); }

    @media (max-width: 768px) {
        .contenu { margin: 5vw; padding: 6vw; }
        h1 { font-size: 1.6rem; }
        #clip-container { width: 100%; }
    }
</style>
</head>

<body>

<div class="contenu" id="intro">
    <h1>üéÑ Le Premier Secret de l‚ÄôAnn√©e</h1>
    <p><strong>Chers Papa et Maman, Papou et Manou...</strong></p>
    <p class="intro-text">Ce soir de No√´l n‚Äôest pas tout √† fait comme les autres. Le cadeau que vous allez ouvrir n‚Äôest pas sous le sapin.</p>
    <p class="intro-text">Il est immat√©riel, tiss√© de temps, d‚Äôamour et de m√©moire.</p>
    <p class="intro-text">Pour vos 80 ans, plusieurs g√©n√©rations se sont unies pour vous cr√©er quelque chose √† votre image.</p>
    <p id="demarrer">‚ú® √âcoutez le foyer s'animer...</p>
</div>

<div id="clip-container">
    <video id="clip" controls playsinline>
        <source src="videos/clip-noel.mp4" type="video/mp4">
        Votre navigateur ne prend pas en charge la vid√©o.
    </video>
</div>

<div class="enigme" id="enigme">
    <p style="font-size: 1.2rem; margin-bottom: 20px;">üéÅ Pour ouvrir ce cadeau, √©crivez le mot magique...</p>
    
    <div class="enigme-container">
        <input type="text" id="reponse" placeholder="√âcrivez ici..." autocomplete="off">
        <button id="valider">Ouvrir !</button>
    </div>
    
    <p id="message-erreur" style="display: none; color:var(--color-lock-red); margin-top:15px;">Le murmure n'est pas clair... Essayez encore üéÑ</p>

    <button id="btnAide" style="display: none;">üí≠ J'ai besoin d'un murmure d'aide</button>
    <p id="indice" style="display: none;">Indice : Le nom de la f√™te !</p>
</div>

<div class="cadeau" id="cadeau">
    <img src="images/etincelles.gif" alt="√©tincelles" class="etincelles" id="etincelles">
</div>

<p class="message" id="bravo" style="font-size:1.4rem; color:#D8A24C; cursor:pointer; text-align:center;">
    üåü Le voile se l√®ve sur une douce surprise... ‚ú®<br>
    üëâ <span id="startAudio" style="text-decoration:underline;">Ouvrir le Message</span>
</p>

<div id="chanson-teaser" class="contenu final-teaser">
    <div id="teaser-content">
        <p class="final-text-line">Il y avait quelque chose que nous voulions vous dire</p>
        <p class="final-text-line">depuis longtemps...</p>
        <br>
        <p class="final-text-line">Avec le c≈ìur.</p>
        <p class="final-click-prompt">Touchez la lettre pour l'ouvrir.</p>
        <div id="btnChanson" class="envelope-trigger">
            <img src="images/enveloppe_finale.png" alt="Lettre scell√©e" class="envelope-image">
        </div>
    </div>

    <div id="listening-content" class="music-listening-state">
        <span class="music-note">üéµ</span>
        <p class="final-text-line" style="font-style:italic;">Laissez la m√©lodie vous emporter...</p>
        <p style="font-size:0.9rem; opacity:0.8;">Le secret se d√©voilera √† la fin de la chanson.</p>
    </div>
</div>

<div class="locked-message" id="locked-message"></div>
<a href="index.html" class="retour" id="retour">‚¨ÖÔ∏è Retour √† l‚Äôaccueil</a>

<audio id="feu" src="audios/feu.mp3" loop></audio>
<audio id="voix" src="audios/message-voix.mp3"></audio>
<audio id="froissement" src="audios/froissement.mp3"></audio>
<audio id="clochette" src="audios/clochette.mp3"></audio>
<audio id="chanson-finale" src="audios/chanson_finale.mp3"></audio> 

<script>
const feu = document.getElementById("feu");
const voix = document.getElementById("voix");
const chansonFinale = document.getElementById("chanson-finale");
const cadeau = document.getElementById("cadeau");
const enigme = document.getElementById("enigme");
const clipContainer = document.getElementById("clip-container");
const clip = document.getElementById("clip");
const bravo = document.getElementById("bravo");
const retour = document.getElementById("retour");
const locked = document.getElementById("locked-message");
const etincelles = document.getElementById("etincelles");
const froissement = document.getElementById("froissement");
const clochette = document.getElementById("clochette");
const intro = document.getElementById("intro");
const inputReponse = document.getElementById("reponse");
const btnAide = document.getElementById("btnAide");
const indice = document.getElementById("indice");
const btnValider = document.getElementById("valider");
const messageErreur = document.getElementById("message-erreur");
const chansonTeaser = document.getElementById("chanson-teaser");
const btnChanson = document.getElementById("btnChanson");
const body = document.body;

// Nouveaux √©l√©ments pour la gestion visuelle
const teaserContent = document.getElementById("teaser-content");
const listeningContent = document.getElementById("listening-content");

let tentatives = 0;
let cadeauOuvert = false; 

const MOTS_DE_PASSE = ["noel", "reveillon"]; 
const UNLOCK_DATE = new Date("2026-06-01T00:00:00");

// --- FONCTIONS AUDIO ---
function fadeOutAudio(audio, duree) {
    const interval = 50;
    const decrement = audio.volume / (duree / interval);
    const fade = setInterval(() => {
        if (audio.volume > decrement) {
            audio.volume -= decrement;
        } else {
            audio.pause();
            audio.volume = 1.0;
            clearInterval(fade);
        }
    }, interval);
}

function fadeInAudio(audio, duree, maxVolume = 0.2) {
    audio.play();
    audio.volume = 0;
    const interval = 50;
    const increment = maxVolume / (duree / interval);
    const fade = setInterval(() => {
        if (audio.volume < maxVolume) {
            audio.volume += increment;
        } else {
            audio.volume = maxVolume;
            clearInterval(fade);
        }
    }, interval);
}

// --- LOGIQUE ---

// 1. D√©marrage
document.getElementById("demarrer").addEventListener("click", () => {
    feu.volume = 0.4; 
    feu.play(); 
    intro.style.opacity = 0;
    setTimeout(() => { intro.style.display = 'none'; }, 3000);
    setTimeout(() => {
        intro.style.display = 'none';
        enigme.style.display = "block";
    }, 800);
});

// 2. Validation Enigme
btnValider.addEventListener("click", () => {
    const reponse = inputReponse.value.trim().toLowerCase();
    messageErreur.style.display = 'none';
    
    if (MOTS_DE_PASSE.includes(reponse)) {
        fadeOutAudio(feu, 500); 
        enigme.style.display = "none";
        clipContainer.style.display = "block";
        clip.load(); 
        clip.play(); 
        if (clip.requestFullscreen) clip.requestFullscreen();
        else if (clip.webkitRequestFullscreen) clip.webkitRequestFullscreen();
        clipContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        tentatives++;
        messageErreur.style.display = 'block';
        if (tentatives >= 2) btnAide.style.display = "inline-block";
    }
});

// 3. Fin Vid√©o
clip.addEventListener("ended", () => {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    clipContainer.style.display = 'none'; 

    if (!cadeauOuvert) {
        cadeau.style.display = "block";
        cadeau.scrollIntoView({ behavior: 'smooth', block: 'start' });
        cadeau.classList.add("ouvert"); // D√©clenche aussi l'animation heartbeat
        froissement.play();
        clochette.play();
        setTimeout(() => { bravo.style.display = "block"; }, 2000);
    }
});

// 4. Start Audio Message
document.getElementById("startAudio").addEventListener("click", () => {
    document.getElementById("bravo").style.display = "none";
    voix.volume = 1.0;
    voix.play();
});

// 5. Fin Audio Voix
voix.onended = () => {
    bravo.style.display = "none";
    body.classList.add("final-background");
    chansonTeaser.style.display = "block";
    chansonTeaser.scrollIntoView({ behavior: 'smooth', block: 'center' });
};

// 6. Lancement Chanson Finale (AM√âLIOR√â)
btnChanson.addEventListener("click", () => {
    // Au lieu de tout cacher, on bascule l'affichage
    teaserContent.style.display = "none"; // Cache l'enveloppe
    listeningContent.style.display = "block"; // Affiche l'animation d'√©coute

    fadeInAudio(chansonFinale, 4000, 0.8);
    
    chansonFinale.onended = () => {
        chansonTeaser.style.display = "none"; // On cache tout le bloc seulement √† la fin
        finalSequence();
    };
});

// 7. S√©quence Finale
function finalSequence() {
    fadeInAudio(feu, 2000, 0.4);
    const now = new Date();
    
    if (now < UNLOCK_DATE) {
        locked.innerHTML = "üîí Le secret a murmur√© son message. Patientez...<br>L'aventure ne se poursuit qu'avec le retour des <strong>premiers bourgeons</strong>.";
    } else {
        locked.innerHTML = "üåø Le temps a fait son ≈ìuvre...<br>Le chemin est d√©sormais d√©verrouill√© sur la page d'accueil.";
    }
    locked.style.display = "block";
    retour.style.display = "block";
    locked.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

btnAide.addEventListener("click", () => {
    indice.style.display = "block";
    btnAide.style.display = "none";
});

// Fallback cadeau
cadeau.addEventListener("click", () => {
    if (clipContainer.style.display === "block" && clip.paused) {
        cadeau.classList.add("ouvert");
        froissement.play();
        clochette.play();
        setTimeout(() => { bravo.style.display = "block"; }, 2000); 
    }
});

</script>
</body>
</html>