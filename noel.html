<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Le Premier Secret de l‚ÄôAnn√©e</title>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">

<style>
    /* D√©finition des couleurs th√©matiques pour la coh√©rence avec index.html */
    :root {
        --color-cacao-dark: #4F352C;    /* Brun Cacao / Textile fonc√© */
        --color-mill√©sime-gold: #B48A64; /* Or/Vin */
        --color-beige-textile: #F7F4F0; /* Beige clair, fond des popups */
        --color-text-dark: #3E332C;
        --color-lock-red: #924B4B;
        --color-accent-gold: #d89617; /* Original : #d89617 */
    }

    body {
        margin: 0;
        font-family: 'Lato', sans-serif;
        background: url('images/fond-noel.jpg') center/cover no-repeat fixed; 
        color: var(--color-text-dark);
        text-align: center;
        overflow-x: hidden;
        transition: background 0.5s ease; 
    }
    
    /* NOUVEAU FOND pour la s√©quence finale */
    body.final-background {
        /* L'image cadeau-ouvert-millesime.png est centr√©e en bas et non zoom√©e */
        background: url('images/cadeau-ouvert-millesime.png') center bottom no-repeat fixed;
        background-size: auto; 
    }

    /* Conteneur principal */
    .contenu {
        background: rgba(255,250,240,0.92);
        max-width: 900px;
        margin: 4vw auto;
        padding: 4vw;
        border-radius: 20px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        transition: opacity 3s ease;
    }

    h1 {
        font-family: 'Cormorant Garamond', serif;
        color: var(--color-cacao-dark);
        font-size: 2rem;
        margin-bottom: 1rem;
        font-weight: 700;
    }

    p {
        line-height: 1.8;
        margin: 1rem 0;
    }
    
    .intro-text strong {
        color: var(--color-accent-gold);
    }

    #demarrer {
        display: inline-block;
        margin-top: 1.5rem;
        color: var(--color-mill√©sime-gold);
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }
    #demarrer:hover { text-decoration: underline; color: var(--color-accent-gold); }

    /* Cadeau */
    .cadeau {
        position: relative;
        margin: 4vw auto;
        width: 280px;
        height: 280px;
        background: url('images/cadeau.jpg') center/cover no-repeat;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        display: none; 
        cursor: pointer;
        transition: transform 1.5s ease;
        z-index: 10; /* AJOUT√â: S'assure qu'il est au premier plan */
        filter: none; /* AJOUT√â: Supprime tout filtre de transparence h√©rit√©e */
    }

    /* √âtincelles */
    .etincelles {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 180px;
        height: 180px;
        transform: translate(-50%, -50%);
        display: none;
        pointer-events: none;
    }

    /* Ruban anim√© */
    

    .cadeau.ouvert {
        transform: scale(1.1) rotateX(15deg);
        filter: brightness(1.3);
    }
    

    /* √ânigme */
    .enigme {
        display: none;
        margin: 15vh auto 2rem;
        background: rgba(255,255,255,0.85);
        padding: 1rem 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        max-width: 400px;
        font-family: 'Cormorant Garamond', serif;
    }
    .enigme-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }
    .enigme input {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-top: 0.5rem;
        flex-grow: 1;
    }
    .enigme button {
        background: var(--color-mill√©sime-gold);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 6px;
        margin-top: 0.5rem;
        cursor: pointer;
        font-weight: bold;
    }
    .enigme button:hover { background: #9d7553; }

    /* Indice */
    #btnAide, #indice {
        font-size: 0.9rem;
        color: var(--color-cacao-dark);
        cursor: pointer;
        margin-top: 10px;
    }
    #btnAide:hover { text-decoration: underline; }

    /* Vid√©o */
    #clip-container {
        display: none;
        width: 90%;
        max-width: 700px;
        margin: 3vw auto;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    #clip {
        width: 100%;
        height: auto;
        border-radius: 16px;
    }

    /* Messages */
    .message {
        display: none;
        font-style: italic;
        margin-top: 1.5rem;
        color: var(--color-accent-gold);
        font-weight: 600;
        font-family: 'Cormorant Garamond', serif;
    }
    
    /* NOUVEAU BLOC CHANSON TEASER - Styles de base conserv√©s pour le placement/affichage */
    #chanson-teaser {
        display: none;
        max-width: 500px;
        margin: 10vh auto; /* Centr√© verticalement */
        border-radius: 15px;
        font-family: 'Cormorant Garamond', serif;
    }
    
    /* NOUVELLES R√àGLES POUR LE BLOC FINAL / LETTRE (assurant la visibilit√©) */
    #chanson-teaser.final-teaser {
        /* MODIFI√â : Fond beige ros√© lumineux (couleur #F7E4D9 en RGBA avec 85% d'opacit√©) */
        background: rgba(247, 228, 217, 0.85); 
        max-width: 600px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        padding-top: 40px;
        padding-bottom: 40px;
    }
    
    /* Red√©finition des styles pour le texte dans ce bloc */
    #chanson-teaser p {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.2rem; 
        margin: 5px 0;
        line-height: 1.3;
        color: var(--color-text-dark);
    }
    
    .final-text-line {
        font-size: 1.5rem; 
        font-weight: 700;
    }

    .final-click-prompt {
        font-size: 1.1rem;
        font-weight: 600;
        margin-top: 30px;
        color: var(--color-text-dark);
    }
    
    /* Styles pour l'image cliquable (l'enveloppe) */
    .envelope-trigger {
        cursor: pointer;
        display: inline-block;
        margin-top: 15px;
        transition: transform 0.3s ease;
    }

    .envelope-trigger:hover {
        transform: scale(1.05); 
    }

    .envelope-image {
        width: 100%;
        max-width: 280px; 
        height: auto;
        border-radius: 8px; 
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        background: none; 
        border: none; 
    }
    
    /* Suppression des styles sp√©cifiques √† l'ancien bouton (car #btnChanson est maintenant un div/image) */
    #btnChanson {
        background: none;
        border: none;
        padding: 0;
        box-shadow: none;
    }


    .locked-message {
        display: none;
        text-align: center;
        color: var(--color-text-dark);
        font-weight: 500;
        background: rgba(255,248,240,0.9);
        padding: 15px 25px;
        border-radius: 10px;
        margin: 30px auto;
        max-width: 600px;
        box-shadow: 0 0 10px rgba(255,255,255,0.4);
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.1rem;
    }
    .locked-message strong {
        /* Texte uniforme */
    }

    .retour {
        display: none;
        background: var(--color-mill√©sime-gold);
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        transition: 0.3s;
        margin-left: auto;
        margin-right: auto;
    }
    .retour:hover { background: #9d7553; }

    @media (max-width: 768px) {
        .contenu { margin: 5vw; padding: 6vw; }
        h1 { font-size: 1.6rem; }
        #clip-container { width: 100%; }
        .enigme-container { flex-direction: column; }
    }
</style>
</head>

<body>
<div class="contenu" id="intro">
    <h1>üéÑ Le Premier Secret de l‚ÄôAnn√©e</h1>
    <p><strong>Chers Papa et Maman, Papou et Manou, notre plus beau Mill√©sime...</strong></p>
    <p class="intro-text">Ce soir de No√´l n‚Äôest pas tout √† fait comme les autres. Le cadeau que vous allez ouvrir n‚Äôest pas sous le sapin.</p>
    <p class="intro-text">Il est immat√©riel, tiss√© de temps, d‚Äôamour et de m√©moire.</p>
    <p class="intro-text">Pour vos 80 ans, plusieurs g√©n√©rations se sont unies pour vous cr√©er quelque chose √† votre image : authentique, simple et profond√©ment pr√©cieux.</p>
    <p class="intro-text">Ce pr√©sent ne se d√©balle pas. Il s‚Äô√©coute, se ressent, et se d√©couvre doucement... comme une promesse.</p>
    <p class="intro-text">Mais attention, ce secret a une date d'√©ch√©ance : en Juin 2026, pr√©parez vos valises. La trame vous m√®nera sous le soleil de l'Occitanie ! üó∫Ô∏è</p>
    <p id="demarrer">‚ú® √âcoutez le foyer s'animer...</p>
</div>

<div id="clip-container">
    <video id="clip" controls playsinline>
        <source src="videos/clip-noel.mp4" type="video/mp4">
        Votre navigateur ne prend pas en charge la vid√©o.
    </video>
</div>

<div class="enigme" id="enigme">
    <p>üéÅ Pour ouvrir ce cadeau et d√©marrer la projection, trouvez le mot magique du r√©veillon...</p>
    
    <div class="enigme-container">
        <input type="text" id="reponse" placeholder="Mot magique...">
        <button id="valider">Ouvrir !</button>
    </div>
    
    <p id="message-erreur" style="display: none;">Le murmure n'est pas clair... Essayez encore üéÑ</p>

    <button id="btnAide" style="display: none;">üí≠ J'ai besoin d'un murmure d'aide</button>
    <p id="indice" style="display: none;">Indice : Le nom de la f√™te !</p>
</div>

<div class="cadeau" id="cadeau">
    <img src="images/etincelles.gif" alt="√©tincelles" class="etincelles" id="etincelles">
</div>


<p class="message" id="bravo" style="font-size:1.4rem; color:#D8A24C; cursor:pointer; text-align:center;">
    üåü Le voile se l√®ve sur une douce surprise... ‚ú®<br>
    üëâ <span id="startAudio" style="text-decoration:underline;">Ouvrir le Message</span>
</p>

<div id="chanson-teaser" class="contenu final-teaser">
    <p class="final-text-line">Il y avait quelque chose que nous voulions vous dire</p>
    <p class="final-text-line">depuis longtemps.</p>
    
    <br>

    <p class="final-text-line">Pas avec une cl√©.</p>
    <p class="final-text-line">Pas avec un code.</p>
    <p class="final-text-line">Mais avec le c≈ìur.</p>
    
    <br>

    <p class="final-click-prompt">Touchez la lettre pour l'ouvrir.</p>

    <div id="btnChanson" class="envelope-trigger">
        <img src="images/enveloppe_finale.png" alt="Lettre scell√©e" class="envelope-image">
    </div>
</div>

<div class="locked-message" id="locked-message"></div>

<a href="index.html" class="retour" id="retour">‚¨ÖÔ∏è Retour √† l‚Äôaccueil</a>

<audio id="feu" src="audios/feu.mp3" loop></audio>
<audio id="voix" src="audios/message-voix.mp3"></audio>
<audio id="froissement" src="audios/froissement.mp3"></audio>
<audio id="clochette" src="audios/clochette.mp3"></audio>
<audio id="chanson-finale" src="audios/chanson_finale.mp3"></audio> <script>
const feu = document.getElementById("feu");
const voix = document.getElementById("voix");
const chansonFinale = document.getElementById("chanson-finale"); // NOUVEL √âL√âMENT
const cadeau = document.getElementById("cadeau");
const enigme = document.getElementById("enigme");
const clipContainer = document.getElementById("clip-container");
const clip = document.getElementById("clip");
const bravo = document.getElementById("bravo");
const retour = document.getElementById("retour");
const locked = document.getElementById("locked-message");
const etincelles = document.getElementById("etincelles");
const froissement = document.getElementById("froissement");
const clochette = document.getElementById("clochette");
const intro = document.getElementById("intro");
const inputReponse = document.getElementById("reponse");
const btnAide = document.getElementById("btnAide");
const indice = document.getElementById("indice");
const btnValider = document.getElementById("valider");
const messageErreur = document.getElementById("message-erreur");
const chansonTeaser = document.getElementById("chanson-teaser"); // NOUVEL √âL√âMENT
const btnChanson = document.getElementById("btnChanson"); // ID conserv√© sur le div/image
const body = document.body; // Pour changer le fond

let tentatives = 0;
let cadeauOuvert = false; 

const MOTS_DE_PASSE = ["noel", "reveillon"]; 
const UNLOCK_DATE = new Date("2026-06-01T00:00:00");

// --- FONCTIONS AUDIO ---
function fadeOutAudio(audio, duree) {
    const interval = 50;
    const decrement = audio.volume / (duree / interval);
    const fade = setInterval(() => {
        if (audio.volume > decrement) {
            audio.volume -= decrement;
        } else {
            audio.pause();
            audio.volume = 1.0; // R√©initialise le volume pour la prochaine lecture si besoin
            clearInterval(fade);
        }
    }, interval);
}

function fadeInAudio(audio, duree, maxVolume = 0.2) { // maxVolume par d√©faut √† 0.2 pour le feu
    audio.play();
    audio.volume = 0;
    const interval = 50;
    const increment = maxVolume / (duree / interval);
    const fade = setInterval(() => {
        if (audio.volume < maxVolume) {
            audio.volume += increment;
        } else {
            audio.volume = maxVolume; // Assure que le volume est exactement maxVolume
            clearInterval(fade);
        }
    }, interval);
}

// --- LOGIQUE DE LA PAGE ---

// 2. üéß D√©marrage (Clic sur 'Que la magie op√®re...')
document.getElementById("demarrer").addEventListener("click", () => {
    // LANCEMENT DU FEU AU CLIC D√âMARRER
    feu.volume = 0.4; 
    feu.play(); 
    
    // 1. Disparition de l'intro
    intro.style.opacity = 0;
    setTimeout(() => { intro.style.display = 'none'; }, 3000);
    
    // 2. Masquer l'intro et afficher l'√©nigme sans saut de page
    setTimeout(() => {
        intro.style.display = 'none';
        enigme.style.display = "block";
    }, 800);
});

// 3. ‚úÖ Validation de l'√©nigme ‚Üí Lance la Vid√©o (et plein √©cran)
btnValider.addEventListener("click", () => {
    const reponse = inputReponse.value.trim().toLowerCase();
    messageErreur.style.display = 'none'; // Cache l'erreur pr√©c√©dente
    
    if (MOTS_DE_PASSE.includes(reponse)) {
        // SUCC√àS
        fadeOutAudio(feu, 500); 
        enigme.style.display = "none";
        
        // Lance la Vid√©o et demande le plein √©cran
        clipContainer.style.display = "block";
        clip.load(); 
        clip.play(); 
        
        // PLEIN √âCRAN DIRECTEMENT SUR LA VID√âO
        if (clip.requestFullscreen) {
            clip.requestFullscreen();
        } else if (clip.webkitRequestFullscreen) {
            clip.webkitRequestFullscreen();
        } else if (clip.msRequestFullscreen) {
            clip.msRequestFullscreen();
        }
        clipContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
    } else {
        // √âCHEC
        tentatives++;
        messageErreur.style.display = 'block'; // AFFICHE L'ERREUR PERSONNALIS√âE
        
        if (tentatives >= 2) {
            btnAide.style.display = "inline-block";
        }
    }
});

// 4. üé¨ Fin de la Vid√©o ‚Üí R√©v√©lation Cadeau + Sons (d√©lai 8s)
clip.addEventListener("ended", () => {
    // Quitte le mode plein √©cran √† la fin de la vid√©o
    if (document.exitFullscreen) {
        document.exitFullscreen();
    } else if (document.webkitExitFullscreen) { 
        document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) { 
        document.msExitFullscreen();
    }

    // ‚¨ÖÔ∏è FAIT DISPARA√éTRE LE CONTENEUR VID√âO
    clipContainer.style.display = 'none'; 

    if (!cadeauOuvert) {
        // 1. Affiche le cadeau
        cadeau.style.display = "block";
        cadeau.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // 2. Ouvre le cadeau et lance les sons (froissement et clochette)
        cadeau.classList.add("ouvert");
        froissement.play();
        clochette.play();
        
        // 3. Lance le message de la voix APR√àS D√âLAI
        setTimeout(() => {
            bravo.style.display = "block";
            voix.volume = 1.0; // Assure le volume maximum
            voix.play(); 
        }, 8000); // ‚¨ÖÔ∏è D√âLAI FINAL √Ä 8s
    }
});

// 5. üîä Fin de l'Audio VOIX ‚Üí Transition vers la Chanson (NOUVELLE LOGIQUE)
voix.onended = () => {
    bravo.style.display = "none";
    
    // 1. Changement de fond d'√©cran
    body.classList.add("final-background");
    
    // 2. Affichage du bloc teaser pour la chanson
    chansonTeaser.style.display = "block";
    chansonTeaser.scrollIntoView({ behavior: 'smooth', block: 'center' });

    // La logique de fin (locked message + retour) est d√©plac√©e dans l'√©couteur de la chanson.
};

// 6. üé∂ Clic sur le bouton Chanson (maintenant l'image/div)
btnChanson.addEventListener("click", () => {
    // D√©marrage de la chanson avec fondu
    fadeInAudio(chansonFinale, 4000, 0.8); // 4 secondes de fondu vers un volume de 0.8 (√† ajuster)
    btnChanson.style.display = "none"; // Optionnel : d√©sactiver ou masquer le bouton
    
    // Attendre la fin de la chanson pour ex√©cuter la s√©quence finale
    chansonFinale.onended = () => {
        // La chanson est finie :
        chansonTeaser.style.display = "none"; // Cache le bloc
        
        // Ex√©cution de la s√©quence finale d'origine
        finalSequence();
    };
});


// 7. üîí Fonction pour la s√©quence finale (Locked Message + Retour)
function finalSequence() {
    fadeInAudio(feu, 2000, 0.4); // Rallume le feu (avec son volume d'origine)

    // Affichage du message de fin po√©tique / verrouill√©
    const now = new Date();
    
    if (now < UNLOCK_DATE) {
        // Message verrouill√© (texte uniforme)
        locked.innerHTML = "üîí Le secret a murmur√© son message. Patientez, nos c≈ìurs sont pleins d'impatience ! L'aventure tiss√©e ne se poursuit qu'avec le retour des <strong>premiers bourgeons</strong> et l'arriv√©e de la <strong>maturit√©</strong>.";
    } else {
        // Message d√©verrouill√© 
        locked.innerHTML = "üåø Le temps a fait son ≈ìuvre... La trame se d√©roule enfin. <br>Le chemin vers la prochaine √©tape est d√©sormais d√©verrouill√© sur la page d'accueil.";
    }
    locked.style.display = "block";
    retour.style.display = "block";
    locked.scrollIntoView({ behavior: 'smooth', block: 'start' });
}


// 8. üí≠ Affichage de l'indice
btnAide.addEventListener("click", () => {
    indice.style.display = "block";
    btnAide.style.display = "none";
});

// 9. S√©quence de secours si la vid√©o √©choue (clic sur cadeau)
cadeau.addEventListener("click", () => {
    if (clipContainer.style.display === "block" && clip.paused) {
        // Si la vid√©o est affich√©e mais ne s'est pas lanc√©e ou a √©chou√©
        cadeau.classList.add("ouvert");
        froissement.play();
        clochette.play();
        
        setTimeout(() => {
            bravo.style.display = "block";
            voix.volume = 1.0; // Assure le volume maximum
            voix.play(); 
        }, 8000); 
    }
});

document.getElementById("startAudio").addEventListener("click", () => {
    document.getElementById("bravo").style.display = "none";
    voix.play();
});

</script>
</body>
</html>