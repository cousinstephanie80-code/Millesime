<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cachette des Tisseurs ‚Äî Version Magique</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  margin:0; padding:0;
  font-family:'Lato',sans-serif;
  background:url('images/fond_textile.png') center/cover fixed;
  color:#3a2f25;
}
.conteneur {
  width:90%; max-width:1100px; margin:40px auto; padding-bottom:60px;
}

/* TITRE */
.titre-page {
  text-align:center;
  font-family:'Lato',sans-serif;
  font-size:36px;
  color:#5a4633;
  margin-bottom:5px;
  overflow:hidden;
  white-space:nowrap;
  width:100%;
  animation:encre 4s steps(40,end) forwards;
}
@keyframes encre { from{width:0;} to{width:100%;} }

@media (max-width: 600px) {
  .titre-page {
    font-size:1.8rem;
    white-space:normal;
    width:100%;
    animation:none;
  }
}

/* NAVETTE ANIM√âE */
.navette {
  width:40px; opacity:.85; position:relative; display:block; margin:0 auto 10px;
  animation:navette 10s ease-in-out infinite;
}
@keyframes navette {
  0%{left:-5px;} 50%{left:5px;} 100%{left:-5px;}
}

.difficulte { text-align:center; font-size:15px; opacity:.7; }
.citation { text-align:center; font-style:italic; opacity:.8; margin-bottom:30px; }

/* INTRO */
.bloc-intro {
  background:rgba(255,255,255,.75);
  border:2px solid #d1bda3;
  border-radius:12px;
  padding:25px;
  margin-bottom:40px;
  box-shadow:0 6px 14px rgba(0,0,0,.10);
}
.bloc-intro h2 {
  font-family:'Lato',sans-serif;
  font-size:1.5rem;
}

/* CARTES CL√âS */
.carte-cles {
  display:flex; gap:20px; flex-wrap:wrap;
}
.cle {
  flex:1;
  min-width:260px;
  background:rgba(255,255,255,.85);
  border:2px solid #d1bda3;
  border-radius:12px;
  padding:20px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
  transition:.3s;
}
.cle:hover {
  transform:translateY(-5px);
  box-shadow:0 10px 20px rgba(0,0,0,.25);
}
.cle h2 {
  font-family:'Lato',sans-serif;
  font-size:22px;
  text-align:center;
}
.cle img {
  width:100%; border-radius:6px; margin-top:10px;
}

/* RITUEL */
.section-rituel {
  margin-top:50px;
  background:rgba(255,255,255,.85);
  border:2px solid #d1bda3;
  border-radius:12px;
  padding:25px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
}

.zone-input { text-align:center; margin-top:10px; }
input[type=text] {
  padding:12px; width:90%; max-width:350px;
  border-radius:6px; border:1px solid #7c6a54;
}
button {
  margin-top:12px; padding:12px 25px; font-size:17px;
  background:#c7b29a; border:2px solid #8d775f;
  border-radius:8px; cursor:pointer; transition:.3s;
}
button:hover { background:#b49a80; }

#btnSuivant {
  display:none; margin:25px auto 10px auto;
  animation:tissage 2s ease-out forwards; opacity:0;
}
@keyframes tissage { 0%{opacity:0; transform:scale(.95);} 100%{opacity:1; transform:scale(1);} }

#indicesBox {
  display:none; margin-top:25px; padding:20px;
  background:url('images/parchemin_pli√©.png') center/cover;
  border:2px solid #c3a986; border-radius:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.15);
  font-style:italic;
}

#message { text-align:center; font-weight:bold; }
.discret { text-align:center; font-size:.85em; opacity:.7; margin-top:8px; }
</style>
</head>

<body>

<div class="conteneur">

<img src="images/navette.png" class="navette">
<h1 class="titre-page">üóùÔ∏è Le Secret de la Double Ville üêë</h1>
<p class="difficulte">(Difficult√© : üîç Facile)</p>
<p class="citation">"Un seul vent suffit pour d√©voiler ce qui a √©t√© effac√© par les √¢ges..."</p>

<div class="bloc-intro">
<h2>üìú Le Myst√®re du Languedoc</h2>
Votre premi√®re destination est un village du Tarn, nich√© dans un Parc Naturel et c√©l√®bre pour son histoire.
Pour la d√©couvrir, rassemblez les mots-cl√©s cach√©s dans cette l√©gende.
</div>

<div class="carte-cles">

<div class="cle">
<h2>Cl√© 1 : G√©ographie et Espace</h2>
<img src="images/Parc_naturelle.png">
Recherchez la cit√© situ√©e au c≈ìur du <b>Parc Naturel R√©gional du Haut-Languedoc</b> et travers√©e par la <b>Vall√©e du Thor√©</b>.
</div>

<div class="cle">
<h2>Cl√© 2 : Histoire et Industrie</h2>
<img src="images/lainage.png">
Elle fut surnomm√©e la <b>Capitale du D√©lainage</b>, prosp√©rant gr√¢ce √† la <b>filature de la laine</b>.
</div>

<div class="cle">
<h2>Cl√© 3 : Nomenclature et Forme</h2>
<img src="images/double_nom.png">
Son nom combine une base <b>m√©di√©vale</b> et une <b>d√©signation g√©ographique</b>.
</div>

</div>

<div class="section-rituel">
<h2>üîì Le Rituel de la D√©couverte</h2>
<p style="text-align:center;">Entrez le <b>nom complet</b> du lieu.<br>(accents, tirets, maj/min ignor√©s)</p>

<div class="zone-input">
<input type="text" id="reponse"><br>
<button onclick="verifier()">Valider</button>
</div>

<p id="message"></p>

<button id="btnSuivant" onclick="location.href='jour1_accueil.html'">D√©voiler le fil suivant</button>

<p class="discret" id="notice" style="display:none;">
(La vignette <b>2 ‚Äî Le savoir-faire oubli√©</b> est d√©bloqu√©e sur la page <b>Accueil Jour 1</b>.)
</p>

<div id="indicesBox">
<h3>ü¶â Le Dernier Murmure du Hibou</h3>
"Le vent vous souffle un secret : 'La Bastide' pour le fort, 'Rouairoux' pour le rouge des bois.
Cherchez l√† o√π le Parc et la Laine se rencontrent."
</div>

</div>
</div>

<script>
let erreurs = 0;
const STATE_DEPART_ACCESSIBLE = 'jour1_depart_ok';

/* Nettoyage universel : rend toutes les orthographes valides */
function nettoyer(texte) {
    return texte
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // supprime accents
        .replace(/[^a-z]/g, ""); // supprime espaces, tirets, apostrophes, etc.
}

/* Quand c'est r√©ussi */
function reussite(message) {
    document.getElementById("message").innerHTML = "‚úî " + message;
    document.getElementById("message").style.color = "#2d6b3a";
    document.getElementById("btnSuivant").style.display = "block";
    document.getElementById("notice").style.display = "block";
    localStorage.setItem(STATE_DEPART_ACCESSIBLE, 'true');

    // Emp√™che de recommencer
    document.querySelector('.zone-input button').disabled = true;
    document.getElementById("reponse").disabled = true; // D√©sactive l'input
}

/* Quand c'est faux */
function echec(msg) {
    document.getElementById("message").innerHTML = "‚ùå " + msg;
    document.getElementById("message").style.color = "#8a1e1e";
}

function verifier() {
    const saisie = nettoyer(document.getElementById("reponse").value);
    // Les diff√©rentes formes accept√©es par la fonction nettoyer
    const bonne = nettoyer("La Bastide-Rouairoux");

    if (saisie === bonne) {
        reussite("Le fil est juste‚Ä¶");
        return;
    }

    erreurs++;

    if (erreurs === 1) {
        // Premi√®re erreur : Affiche l'indice
        echec("Ce n‚Äôest pas encore le bon fil‚Ä¶ Un souffle du vent vous guide‚Ä¶ Consultez l‚Äôindice.");
        document.getElementById("indicesBox").style.display = "block";
    }
    else if (erreurs === 2) {
        // Deuxi√®me erreur : Affiche la r√©ponse et la valide automatiquement
        reussite("Le vent vous souffle la r√©ponse : La Bastide-Rouairoux.");
        document.getElementById("indicesBox").style.display = "block";
    }
    else if (erreurs >= 3) {
        // Si l'utilisateur clique encore apr√®s l'affichage de la r√©ponse, assure la validation
        reussite("Vous avez d√©j√† trouv√© la destination : La Bastide-Rouairoux.");
    }
}

/* * MODIFICATION : 
* J'ai retir√© le bloc document.addEventListener('DOMContentLoaded', ...) pour ne pas masquer le formulaire d'entr√©e
* si l'√©nigme a d√©j√† √©t√© r√©solue dans une session pr√©c√©dente.
* Pour rejouer, l'utilisateur devra effacer le localStorage manuellement (F12 > Application > Local Storage)
* ou simplement recharger le fichier.
*/
</script>

</body>
</html>