<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jour 1 — Énigme & Dîner</title>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Montserrat:wght@300;400;500;600&family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-overlay: rgba(58, 36, 28, 0.35);

      /* Verre chaud (G1) */
      --glass-1: rgba(255, 252, 246, 0.62);
      --glass-2: rgba(255, 255, 255, 0.42);
      --glass-border: rgba(180,138,100,0.28);

      --card-bg: #F6F1EA;
      --text-main: #4A3B32;
      --muted: #7A6A5D;
      --accent: #800020;
      --gold: #B48A64;

      --shadow: 0 18px 50px rgba(0,0,0,0.18);
      --shadow-soft: 0 10px 28px rgba(0,0,0,0.12);
      --radius: 22px;

      /* Typo */
      --title-script: 'Great Vibes', cursive;
      --title-serif: 'Cormorant Garamond', serif;
      --body-sans: 'Montserrat', sans-serif;

      /* Finitions */
      --title-shadow: 0 10px 22px rgba(0,0,0,0.10);
      --title-shadow-soft: 0 8px 18px rgba(0,0,0,0.08);
    }

    body{
      margin:0;
      min-height:100vh;
      font-family: var(--body-sans);
      color: var(--text-main);

      background-image: url('images/vignette_plat.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      position:relative;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 6vw 0;
      transition: padding-right 0s;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background: var(--bg-overlay);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index:-1;
    }

    .card-container{
      width: 92%;
      max-width: 920px;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      animation: slideUp .8s ease-out;
      border: 1px solid rgba(180,138,100,0.20);
    }

    @keyframes slideUp{
      from { opacity:0; transform: translateY(18px); }
      to   { opacity:1; transform: translateY(0); }
    }

    .card-container::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.16;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
    }

    .inner{ padding: 38px 34px; position:relative; z-index:1; }

    .kicker{
      text-align:center;
      font-size: 0.78rem;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(74,59,50,0.65);
      margin-bottom: 10px;
    }

    h1,
    .reveal-title,
    .welcome-title,
    .nom-restau-decrypte,
    .culinary-title {
      font-family: var(--title-script);
      font-weight: 400;
      letter-spacing: 0.02em;
      color: var(--accent);
      text-align:center;
      text-shadow: var(--title-shadow);
    }

    h1{
      font-size: clamp(2.35rem, 5vw, 3.15rem);
      margin: 0 0 6px;
      line-height: 1.04;
    }

    .subtitle{
      text-align:center;
      font-style: italic;
      color: var(--muted);
      margin: 0 0 20px;
      font-size: 1.02rem;
      line-height: 1.5;
    }

    .divider{
      height: 1px;
      background: linear-gradient(to right, transparent, var(--gold), transparent);
      width: 62%;
      margin: 18px auto 26px;
      opacity:.9;
    }

    p{
      text-align:center;
      font-size: 0.98rem;
      line-height: 1.75;
      margin: 10px auto;
      max-width: 780px;
      color: rgba(74,59,50,0.92);
    }

    h2, h3, h4, .question-title{
      text-align:center;
      font-family: var(--title-serif);
    }

    h2{
      margin-top: 26px;
      font-size: 1.9rem;
      color: var(--accent);
      font-weight:700;
      line-height: 1.12;
      text-shadow: var(--title-shadow-soft);
    }

    .panel{
      margin: 18px auto;
      max-width: 760px;
      background: var(--glass-1);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      padding: 22px 20px;
      position:relative;
      backdrop-filter: blur(10px);
    }
    .panel::after{
      content:"";
      position:absolute;
      inset:12px;
      border-radius: 14px;
      border: 1px solid rgba(180,138,100,0.14);
      pointer-events:none;
    }

    .welcome-note{
      max-width: 760px;
      margin: 0 auto 14px;
      background:
        radial-gradient(260px 180px at 18% 30%, rgba(180,138,100,0.12) 0%, rgba(255,255,255,0) 62%),
        var(--glass-2);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      padding: 18px 18px;
      position:relative;
      text-align:center;
      backdrop-filter: blur(12px);
    }
    .welcome-note::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: 14px;
      border: 1px solid rgba(180,138,100,0.14);
      pointer-events:none;
    }
    .welcome-title{
      font-size: clamp(1.9rem, 3.8vw, 2.5rem);
      margin: 0 0 6px;
    }
    .welcome-text{
      margin: 0;
      color: rgba(74,59,50,0.88);
      font-style: italic;
      font-size: 1.02rem;
      line-height: 1.65;
    }

    /* Enigme & Envelope Step */
    #blocEnigme{ max-width: 760px; margin: 0 auto; }
    
    /* Bloc Intermédiaire Enveloppe (caché par défaut) */
    #blocInstructionEnvelope { display:none; max-width: 760px; margin: 0 auto; }

    .question-title{
      color: var(--accent);
      font-size: 1.45rem;
      margin: 0 0 6px;
      font-weight:700;
      text-align:center;
    }
    .hint{ text-align:center; color: rgba(74,59,50,0.78); margin-top: 0; }

    .input-row{
      display:flex;
      justify-content:center;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    #roomNumberInput{
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(180,138,100,0.55);
      background: rgba(255,255,255,0.78);
      min-width: 210px;
      font-size: 1.05rem;
      text-align:center;
      outline:none;
      box-shadow: 0 8px 18px rgba(0,0,0,0.07);
    }
    #roomNumberInput:focus{
      border-color: rgba(128,0,32,0.55);
      box-shadow: 0 10px 22px rgba(128,0,32,0.10);
    }

    @keyframes pulse-gold {
      0% { box-shadow: 0 0 0 0 rgba(180, 138, 100, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(180, 138, 100, 0); }
      100% { box-shadow: 0 0 0 0 rgba(180, 138, 100, 0); }
    }

    .btn{
      border: 1px solid rgba(180,138,100,0.45);
      background: linear-gradient(135deg, rgba(128,0,32,0.95), rgba(110,0,28,0.92));
      color: #fff;
      padding: 12px 18px;
      border-radius: 12px;
      font-weight: 600;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      box-shadow: 0 14px 28px rgba(128,0,32,0.20);
      letter-spacing: .02em;
    }
    .btn:hover{
      transform: translateY(-2px);
      filter: brightness(1.03);
      box-shadow: 0 18px 34px rgba(128,0,32,0.24);
    }
    #btnValiderEnigme { animation: pulse-gold 2s infinite; }
    #btnEnvelopeOk { animation: pulse-gold 2s infinite; }

    .btn-secondary{
      background: rgba(255,255,255,0.70);
      color: var(--accent);
      border: 1px solid rgba(180,138,100,0.55);
      box-shadow: 0 12px 24px rgba(0,0,0,0.10);
      backdrop-filter: blur(10px);
    }

    #messageErreur{
      color:#b23a3a;
      display:none;
      font-weight:600;
      margin-top: 10px;
      text-align:center;
    }

    #blocRevelationRestau{ display:none; }

    .reveal-title{
      font-size: clamp(2.35rem, 5vw, 3.0rem);
      margin: 0 0 6px;
      line-height: 1.04;
    }
    .reveal-subtitle{
      text-align:center;
      font-style: italic;
      color: rgba(74,59,50,0.75);
      margin: 0 0 14px;
      font-size: 1.05rem;
      line-height: 1.55;
    }

    .info-restau{
      max-width: 520px;
      margin: 22px auto;
      padding: 18px 18px;
      border-radius: 18px;
      background:
        radial-gradient(260px 160px at 20% 20%, rgba(180,138,100,0.12) 0%, rgba(255,255,255,0) 60%),
        var(--glass-1);
      border: 1px solid rgba(180,138,100,0.35);
      box-shadow: var(--shadow-soft);
      text-align:center;
      position:relative;
      backdrop-filter: blur(12px);
    }
    .info-restau::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: 14px;
      border: 1px solid rgba(180,138,100,0.18);
      pointer-events:none;
    }
    .label{
      display:inline-block;
      font-size: .78rem;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(74,59,50,0.60);
      margin-bottom: 8px;
    }
    .nom-restau-decrypte{
      display:block;
      font-size: 2.55rem;
      margin: 6px 0 8px;
    }
    .info-line{
      font-weight: 600;
      color: rgba(74,59,50,0.88);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }
    .info-line span { white-space: nowrap; }

    /* MENU */
    .menu-grid{
      display:flex;
      justify-content:center;
      gap: 18px;
      margin-top: 18px;
      flex-wrap:wrap;
    }

    .menu-card{
      flex: 1 1 220px;
      max-width: 260px;
      background: var(--glass-1);
      border-radius: 18px;
      padding: 18px 16px;
      border: 1px solid rgba(180,138,100,0.28);
      box-shadow: var(--shadow-soft);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(12px);
      transform: translateY(6px);
      opacity: 0;
      transition: transform .6s ease, opacity .6s ease;
    }
    .menu-card.is-visible{ transform: translateY(0); opacity: 1; }

    .menu-card::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(220px 160px at 30% 20%, rgba(128,0,32,0.06) 0%, transparent 65%);
    }

    .menu-card h4{
      font-family: var(--title-serif);
      font-size: 1.35rem;
      color: var(--accent);
      margin: 0 0 10px;
      font-weight:700;
      text-shadow: var(--title-shadow-soft);
    }

    .menu-card ul{
      list-style:none;
      padding:0;
      margin:0;
      font-size: 0.95rem;
      color: rgba(74,59,50,0.90);
    }
    .menu-card ul li{
      margin-bottom: 9px;
      padding-bottom: 7px;
      border-bottom: 1px dotted rgba(74,59,50,0.18);
    }

    /* ===== CAROUSEL ===== */
    .carousel-shell{ max-width: 760px; margin: 26px auto 10px; }
    .carousel-container{
      width: 100%; position:relative; overflow:hidden;
      border-radius: 18px; box-shadow: var(--shadow);
      border: 1px solid rgba(180,138,100,0.22);
      background: rgba(255,255,255,0.20);
    }
    .storybar{
      position:absolute; top: 12px; left: 12px; right: 12px; z-index: 6;
      display:flex; gap: 8px; pointer-events: auto;
    }
    .story-seg{
      flex: 1 1 auto; height: 6px; border-radius: 999px;
      background: rgba(255,255,255,0.45);
      border: 1px solid rgba(180,138,100,0.22); overflow:hidden;
      backdrop-filter: blur(10px); cursor:pointer;
    }
    .story-seg .fill{
      width: 0%; height: 100%; border-radius: 999px;
      background: rgba(128,0,32,0.92); transform-origin: left;
    }
    .story-seg.is-active .fill{ animation: storyFill .85s ease-out forwards; }
    @keyframes storyFill{ from { width: 0%; } to { width: 100%; } }

    .carousel-stage{ position:relative; width:100%; height: 280px; }
    .carousel-slide{
      position:absolute; inset:0; opacity:0;
      transition: opacity .65s ease; pointer-events:none;
    }
    .carousel-slide.is-active{ opacity:1; pointer-events:auto; }
    .carousel-slide img{
      width:100%; height:100%; object-fit: cover;
      display:block; cursor: zoom-in;
    }

    .carousel-caption{
      position:absolute; left: 14px; right: 14px; bottom: 14px; z-index: 6;
      padding: 12px 14px; border-radius: 14px;
      background: rgba(255, 252, 246, 0.62);
      border: 1px solid rgba(180,138,100,0.22);
      backdrop-filter: blur(12px);
      color: rgba(74,59,50,0.92); text-align:center;
      font-style: italic; line-height: 1.5;
      box-shadow: 0 12px 28px rgba(0,0,0,0.16);
    }
    .carousel-caption strong{
      font-family: var(--title-serif); font-style: normal;
      color: var(--accent); font-weight: 700; margin-right: 6px;
    }

    .carousel-btn{
      position:absolute; top:50%; transform: translateY(-50%); z-index:7;
      width: 44px; height: 44px; border-radius: 999px;
      border: 1px solid rgba(180,138,100,0.45);
      background: rgba(255,255,255,0.76); cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      font-size: 26px; color: var(--accent); font-weight: 700;
      box-shadow: 0 10px 22px rgba(0,0,0,0.12);
      transition: transform .18s ease, background .18s ease;
      backdrop-filter: blur(12px);
    }
    .carousel-btn:hover{
      transform: translateY(-50%) scale(1.04); background: rgba(255,255,255,0.92);
    }
    .carousel-btn.prev{ left: 14px; }
    .carousel-btn.next{ right: 14px; }

    .closing-note{
      text-align:center; margin-top: 14px;
      color: rgba(74,59,50,0.78); font-style: italic;
    }
    .footer-actions{ text-align:center; margin-top: 14px; }

    /* ===== Lightbox ===== */
    .lightbox{
      position: fixed; inset: 0; z-index: 9999;
      display:none; align-items:center; justify-content:center;
      background: rgba(20, 12, 10, 0.72);
      backdrop-filter: blur(10px); padding: 18px;
    }
    .lightbox.is-open{ display:flex; }
    .lightbox-inner{
      width: min(980px, 96vw); max-height: 92vh; position:relative;
      border-radius: 18px; overflow:hidden;
      border: 1px solid rgba(180,138,100,0.22);
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      background: rgba(255,255,255,0.06);
    }
    .lightbox-img{
      width: 100%; height: min(72vh, 640px); object-fit: contain;
      background: rgba(0,0,0,0.25); display:block;
      user-select:none; -webkit-user-drag: none;
    }
    .lightbox-caption{
      padding: 12px 14px 16px; text-align:center;
      color: rgba(255,255,255,0.92); font-style: italic; line-height: 1.5;
      background: linear-gradient(to top, rgba(0,0,0,0.45), rgba(0,0,0,0.05));
    }
    .lightbox-caption strong{
      font-family: var(--title-serif); font-style: normal;
      color: #fff; font-weight: 700; margin-right: 6px;
    }
    .lightbox-close{
      position:absolute; top: 10px; right: 10px; z-index:2;
      width: 44px; height: 44px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.14); color: #fff; font-size: 22px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(10px);
      transition: transform .18s ease, background .18s ease;
    }
    .lightbox-close:hover{ transform: scale(1.05); background: rgba(255,255,255,0.22); }
    .lightbox-nav{
      position:absolute; top: 50%; transform: translateY(-50%);
      width: 52px; height: 52px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.12); color: #fff; font-size: 28px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      backdrop-filter: blur(10px);
      transition: transform .18s ease, background .18s ease; z-index:2;
    }
    .lightbox-nav:hover{ transform: translateY(-50%) scale(1.06); background: rgba(255,255,255,0.20); }
    .lightbox-nav.prev{ left: 10px; }
    .lightbox-nav.next{ right: 10px; }

    .fade-up{
      opacity: 0; transform: translateY(10px);
      transition: opacity .7s ease, transform .7s ease;
    }
    .fade-up.is-visible{ opacity: 1; transform: translateY(0); }

    /* Mobile */
    @media (max-width: 650px){
      body{ padding: 7vw 0; }
      .inner{ padding: 26px 16px; }
      .divider{ width: 78%; }
      h1{ font-size: clamp(2.15rem, 9vw, 2.65rem); }
      .reveal-title{ font-size: clamp(2.05rem, 8.6vw, 2.55rem); }
      .carousel-stage{ height: 360px; }
      .carousel-btn{ width: 40px; height: 40px; font-size: 24px; }
      .carousel-btn.prev{ left: 10px; }
      .carousel-btn.next{ right: 10px; }
      .storybar{ top: 10px; left: 10px; right: 10px; gap: 6px; }
      .story-seg{ height: 7px; }
      .carousel-caption{ left: 10px; right: 10px; bottom: 10px; padding: 12px 12px; font-size: 0.98rem; }
      .menu-grid{ gap: 12px; }
      .menu-card{ max-width: 100%; flex: 1 1 100%; padding: 16px 14px; }
      .lightbox-img{ height: 62vh; }
    }
  </style>
</head>

<body>
  <div class="card-container">
    <div class="inner">

      <div id="blocEnigme" class="fade-up">
        <div class="kicker">Jour 1 • Millésime</div>
        <h1>Le Dernier Écho du Jour 1</h1>
        <div class="subtitle">Avant de rejoindre la table, un dernier sceau à lever…</div>
        <div class="divider"></div>

        <div class="welcome-note fade-up">
          <div class="welcome-title">Douce installation…</div>
          <p class="welcome-text">
            Nous espérons que votre arrivée à l’hôtel s’est faite tout en douceur,
            que votre chambre vous plaît, et que ce petit cocon vous offre déjà un vrai souffle de repos.
            <br>
            Avant de partir vers la suite de votre Millésime… un dernier sceau à lever.
          </p>
        </div>

        <div class="panel fade-up">
          <div class="question-title">Le Sceau du Refuge</div>
          <p class="hint">Quel numéro porte votre chambre ?</p>

          <div class="input-row">
            <input id="roomNumberInput" type="number" placeholder="Entrez le chiffre" inputmode="numeric">
            <button id="btnValiderEnigme" class="btn">Révéler la table</button>
          </div>

          <p id="messageErreur">Veuillez entrer un numéro.</p>
        </div>
      </div>

      <div id="blocInstructionEnvelope" class="fade-up">
        
        <div class="kicker">Mise en bouche</div>
        <div class="culinary-title" style="font-size: 2.8rem; margin-bottom: 20px;">L'Ingrédient Secret</div>
        
        <div class="panel">
            <p style="font-style: italic; opacity: 0.8; margin-bottom: 25px;">
                "Le numéro est exact. La porte s'entrouvre..."
            </p>
            
            <p style="font-size: 1.1rem; line-height: 1.8;">
                Mais un grand dîner commence toujours par un rituel.<br>
                Pour découvrir votre destination, munissez-vous de l'enveloppe :
            </p>
            
            <h2 style="font-size: 2.5rem; margin: 25px 0; color: var(--gold);">RESTAURANT</h2>
            
            <p>
                Ouvrez-la délicatement.<br>
                À l'intérieur se trouve le bon pour votre voyage culinaire.
            </p>
            
            <div class="divider" style="width: 40%;"></div>
            
            <div class="input-row">
                <button id="btnEnvelopeOk" class="btn">Passons à table</button>
            </div>
        </div>
      </div>

      <div id="blocRevelationRestau">

        <div class="kicker fade-up">Jour 1 • Millésime</div>
        <div class="reveal-title fade-up">La Révélation du Dîner</div>
        <div class="reveal-subtitle fade-up">Félicitations, le sésame est levé…</div>
        <div class="divider fade-up"></div>

        <div class="carousel-shell fade-up">
          <div class="carousel-container" aria-label="Galerie photos du dîner">

            <div class="storybar" aria-label="Progression des photos"></div>
            <button class="carousel-btn prev" aria-label="Photo précédente">‹</button>

            <div class="carousel-stage">
              <div class="carousel-slide is-active" data-title="Le Prélude" data-caption="Une première promesse, délicate et lumineuse.">
                <img src="images/plat1.jpeg" alt="Plat 1 — Le Prélude">
              </div>
              <div class="carousel-slide" data-title="L’Apogée" data-caption="Quand les saveurs parlent… et que le temps ralentit.">
                <img src="images/plat2.jpg" alt="Plat 2 — L’Apogée" loading="lazy">
              </div>
              <div class="carousel-slide" data-title="Le Cœur du Feu" data-caption="Braise, jus, textures… l’instant signature.">
                <img src="images/plat3.jpeg" alt="Plat 3 — Le Cœur du Feu" loading="lazy">
              </div>
              <div class="carousel-slide" data-title="L’Épilogue" data-caption="Une douceur qui reste, comme un écho dans la nuit.">
                <img src="images/plat4.jpg" alt="Plat 4 — L’Épilogue" loading="lazy">
              </div>

              <div class="carousel-caption" aria-live="polite">
                <strong>Le Prélude</strong><span>Une première promesse, délicate et lumineuse.</span>
              </div>
            </div>

            <button class="carousel-btn next" aria-label="Photo suivante">›</button>
          </div>
        </div>

        <div class="info-restau fade-up">
          <div class="label">Lieu d’exception</div>
          <span class="nom-restau-decrypte">L'Ispiens</span>
          
          <div class="info-line">
            <span>✦ 19h30</span>
            <span style="opacity:0.5; font-weight:300;">|</span>
            <span>✦ 2 Route de Jourdes – Le Verdier</span>
          </div>
        </div>

        <h2 class="fade-up">Un voyage culinaire en trois actes</h2>

        <div class="menu-grid">
          <div class="menu-card">
            <h4>Acte I — Le Prélude</h4>
            <ul>
              <li>Foie gras mi-cuit</li>
              <li>Gravlax de saumon</li>
              <li>Escargots de Bourgogne</li>
            </ul>
          </div>

          <div class="menu-card">
            <h4>Acte II — L'Apogée</h4>
            <ul>
              <li>Ris de veau doré</li>
              <li>Confit de canard</li>
              <li>Dorade royale grillée</li>
            </ul>
          </div>

          <div class="menu-card">
            <h4>Acte III — L'Épilogue</h4>
            <ul>
              <li>Fondant chocolat</li>
              <li>Crème brûlée</li>
              <li>Fromages locaux</li>
            </ul>
          </div>
        </div>

        <p class="closing-note fade-up">Que ce dîner soit à la hauteur de votre Millésime…</p>

        <div class="footer-actions fade-up">
          <button id="btnTerminerDiner" class="btn btn-secondary">Cap sur les rêves</button>
        </div>

      </div>
    </div>
  </div>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lightbox-inner" role="dialog" aria-modal="true" aria-label="Photo en plein écran">
      <button class="lightbox-close" id="lightboxClose" aria-label="Fermer">×</button>
      <button class="lightbox-nav prev" id="lightboxPrev" aria-label="Photo précédente">‹</button>
      <button class="lightbox-nav next" id="lightboxNext" aria-label="Photo suivante">›</button>

      <img class="lightbox-img" id="lightboxImg" alt="Photo du dîner">
      <div class="lightbox-caption" id="lightboxCaption">
        <strong></strong><span></span>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const KEY = "jour1_restau_ok";

  const blocEnigme = document.getElementById("blocEnigme");
  const blocEnvelope = document.getElementById("blocInstructionEnvelope");
  const blocRevelation = document.getElementById("blocRevelationRestau");
  
  const input = document.getElementById("roomNumberInput");
  const btnValider = document.getElementById("btnValiderEnigme");
  const btnEnvelopeOk = document.getElementById("btnEnvelopeOk");
  const msgErreur = document.getElementById("messageErreur");
  const btnFin = document.getElementById("btnTerminerDiner");

  // Fade initial
  const initialFade = document.querySelectorAll("#blocEnigme.fade-up, #blocEnigme .fade-up");
  initialFade.forEach(el => el.classList.add("is-visible"));

  /* --- ÉTAPE 1 : VALIDATION CODE -> AFFICHE ENVELOPPE --- */
  btnValider.addEventListener("click", () => {
    if (String(input.value).trim() !== "") {
      input.blur();
      
      // Cache l'énigme
      blocEnigme.style.display = "none";
      
      // Affiche l'étape enveloppe
      blocEnvelope.style.display = "block";
      
      // Petite animation d'entrée pour l'enveloppe
      setTimeout(() => {
          blocEnvelope.classList.add("is-visible");
      }, 50);

    } else {
      msgErreur.style.display = "block";
    }
  });

  /* --- ÉTAPE 2 : CONFIRMATION ENVELOPPE -> AFFICHE REVELATION --- */
  btnEnvelopeOk.addEventListener("click", () => {
      // Cache l'instruction enveloppe
      blocEnvelope.style.display = "none";
      
      // Affiche la révélation finale
      blocRevelation.style.display = "block";
      blocRevelation.scrollIntoView({ behavior: "smooth" });
      
      localStorage.setItem(KEY, "true");
      requestAnimationFrame(() => runRevealAnimations());
  });

  btnFin.addEventListener("click", () => {
    window.location.href = "jour1_accueil.html";
  });

  /* ====== ANIMATIONS & CAROUSEL ====== */
  function runRevealAnimations(){
    const items = blocRevelation.querySelectorAll(".fade-up");
    items.forEach(el => el.classList.remove("is-visible"));

    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          entry.target.classList.add("is-visible");
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.12 });

    items.forEach(el => io.observe(el));

    const cards = blocRevelation.querySelectorAll(".menu-card");
    const ioCards = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          entry.target.classList.add("is-visible");
          ioCards.unobserve(entry.target);
        }
      });
    }, { threshold: 0.18 });

    cards.forEach(c => ioCards.observe(c));
  }

  const container = document.querySelector(".carousel-container");
  if(container){
    const slides = Array.from(container.querySelectorAll(".carousel-slide"));
    const prevBtn = container.querySelector(".carousel-btn.prev");
    const nextBtn = container.querySelector(".carousel-btn.next");
    const captionBox = container.querySelector(".carousel-caption");
    const storybar = container.querySelector(".storybar");

    let index = 0;

    slides.forEach((_, i) => {
      const seg = document.createElement("div");
      seg.className = "story-seg";
      seg.setAttribute("role", "button");
      seg.setAttribute("tabindex", "0");
      seg.setAttribute("aria-label", `Aller à la photo ${i+1}`);

      const fill = document.createElement("div");
      fill.className = "fill";
      seg.appendChild(fill);

      seg.addEventListener("click", () => goTo(i));
      storybar.appendChild(seg);
    });

    const segs = Array.from(storybar.querySelectorAll(".story-seg"));

    function setCaption(i){
      const title = slides[i].dataset.title || "";
      const txt = slides[i].dataset.caption || "";
      captionBox.querySelector("strong").textContent = title;
      captionBox.querySelector("span").textContent = txt;
    }

    function setActive(i){
      slides.forEach(s => s.classList.remove("is-active"));
      slides[i].classList.add("is-active");

      segs.forEach(seg => {
        seg.classList.remove("is-active");
        const fill = seg.querySelector(".fill");
        fill.style.animation = "none";
        fill.offsetHeight; 
        fill.style.animation = "";
      });
      segs[i].classList.add("is-active");

      setCaption(i);
    }

    function goTo(i){
      index = (i + slides.length) % slides.length;
      setActive(index);
    }

    nextBtn.addEventListener("click", () => goTo(index + 1));
    prevBtn.addEventListener("click", () => goTo(index - 1));

    container.addEventListener("keydown", (e) => {
      if(e.key === "ArrowRight") goTo(index + 1);
      if(e.key === "ArrowLeft") goTo(index - 1);
    });

    setActive(0);

    /* Lightbox */
    const lightbox = document.getElementById("lightbox");
    const lbImg = document.getElementById("lightboxImg");
    const lbCap = document.getElementById("lightboxCaption");
    const lbClose = document.getElementById("lightboxClose");
    const lbPrev = document.getElementById("lightboxPrev");
    const lbNext = document.getElementById("lightboxNext");

    const getScrollbarWidth = () => window.innerWidth - document.documentElement.clientWidth;
    let startX = null;

    function openLightbox(i){
      index = i;
      const img = slides[index].querySelector("img");
      lbImg.src = img.src;
      lbImg.alt = img.alt;
      const t = slides[index].dataset.title || "";
      const c = slides[index].dataset.caption || "";
      lbCap.querySelector("strong").textContent = t;
      lbCap.querySelector("span").textContent = c;
      document.body.style.paddingRight = `${getScrollbarWidth()}px`;
      document.body.style.overflow = "hidden";
      lightbox.classList.add("is-open");
      lightbox.setAttribute("aria-hidden", "false");
    }

    function closeLightbox(){
      lightbox.classList.remove("is-open");
      lightbox.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
      document.body.style.paddingRight = "";
    }

    function syncFromLightbox(i){
      index = (i + slides.length) % slides.length;
      setActive(index);
      const img = slides[index].querySelector("img");
      lbImg.src = img.src;
      lbImg.alt = img.alt;
      const t = slides[index].dataset.title || "";
      const c = slides[index].dataset.caption || "";
      lbCap.querySelector("strong").textContent = t;
      lbCap.querySelector("span").textContent = c;
    }

    slides.forEach((slide, i) => {
      const img = slide.querySelector("img");
      img.addEventListener("click", () => openLightbox(i));
    });

    lbClose.addEventListener("click", closeLightbox);
    lbPrev.addEventListener("click", () => syncFromLightbox(index - 1));
    lbNext.addEventListener("click", () => syncFromLightbox(index + 1));

    lightbox.addEventListener("click", (e) => {
      if(e.target === lightbox) closeLightbox();
    });

    document.addEventListener("keydown", (e) => {
      if(!lightbox.classList.contains("is-open")) return;
      if(e.key === "Escape") closeLightbox();
      if(e.key === "ArrowRight") syncFromLightbox(index + 1);
      if(e.key === "ArrowLeft") syncFromLightbox(index - 1);
    });

    lightbox.addEventListener("touchstart", (e) => {
      if(!lightbox.classList.contains("is-open")) return;
      startX = e.touches[0].clientX;
    }, { passive:true });

    lightbox.addEventListener("touchend", (e) => {
      if(!lightbox.classList.contains("is-open") || startX === null) return;
      const endX = e.changedTouches[0].clientX;
      const dx = endX - startX;
      startX = null;
      if(Math.abs(dx) > 40){
        if(dx < 0) syncFromLightbox(index + 1);
        else syncFromLightbox(index - 1);
      }
    }, { passive:true });
  }
});
</script>

</body>
</html>